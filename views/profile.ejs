<%- include("partials/header") %>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-4 text-center p-3">
            <div class="profile">
                <div class="profile-pic-container">
                    <img src="/profile/picture" class="rounded-circle profile-pic"> <br>
                </div>
                <h1 class="mt-3"> <%= user.fullName %></h1>
                <h3>@<%=user.username%></h3>
                <p class="lead"><%= user.bio%></p>
                <p class="lead">Following: <%= user.following.length%> </p>
                <p class="lead">Followers: <%= user.followers.length%> </p>
                <a href="/logout">Log out</a>
            </div>
        </div>
        <div class="col-6">
            <form action="/new-post/profile" method="POST" class="post-form">
                <div class="form-group">
                    <input class="form-control" type="text" placeholder="What song's on your mind?" name="content" required>
                </div>
                <div class="form-group">
                    <input class="form-control song" autocomplete="off" placeholder="Search for your song" name="song" required list="songs-list">
                    <ul class="song-display-items display-none">
                        <li class="first"></li>
                        <li class="second"></li>
                        <li class="third"></li>
                        <li class="fourth"></li>
                        <li class="fifth"></li>
                    </ul>

                </div>
                <input type="hidden" name="songlink" required>
                <p class="lead error-message display-none">Must select a song from the dropdown menu</p>
                <div class="form-group">
                    <input type="submit" value="Post" class="btn btn-primary btn-block">
                </div>
            </form>
            <% if (posts.length == 0) { %>
                <h4 class="text-center my-5">No posts yet...</h4>
            <% } %>
            <ul class="posts">
                <% posts.reverse().forEach(post => {%>
                    <li class="post">
                        <div class="post-dropdown">
                            <i  class="post-dropdown-arrow fas fa-angle-down"></i>
                            <ul class="post-dropdown-arrow-list display-none rounded">
                                <% if (post.author.id.equals(user._id)) { %>
                                    <a href="#"><li>Edit post</li></a>
                                    <a href="/delete-post/<%= post._id %>/profile"><li>Delete post</li></a>
                                <% } %>
                                <a href="#"><li>Share</li></a>
                            </ul>
                        </div>
                        <p class="lead">@<a href="/profile"><%=post.author.username %></a> <span class="date" style="font-size: .7em;"><%=post.date%></span> </p>
                        <p class="lead"><span class="post-content"><%= post.content %></span></p>
                        <div class="spotify-embeds">
                            <div class="spotify-embed">
                                <iframe class="rounded song-tile" src="<%= post.song %>"   frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
                            </div>
                        </div>
                    </li>
                <% })%>
            </ul>
        </div>
    </div>
</div>

<script src="/js/script.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="module" src="/js/spotify.js"></script>
<%- include("partials/footer") %>